{"version":3,"file":"StepModal.mjs","sources":["../../../../../admin/src/components/AIChat/components/StepModal.tsx"],"sourcesContent":["import {\n  createContext,\n  useContext,\n  useState,\n  ReactNode,\n  Children,\n  isValidElement,\n  FormEvent,\n  useEffect,\n} from 'react';\n\nimport { Modal, Box, Button, Typography } from '@strapi/design-system';\n\n/* -------------------------------------------------------------------------------------------------\n * Context\n * -----------------------------------------------------------------------------------------------*/\n\ninterface StepModalContextType {\n  currentStep: number;\n  goToStep: (step: number) => void;\n  nextStep: () => Promise<boolean>;\n  prevStep: () => void;\n  isFirstStep: boolean;\n  isLastStep: boolean;\n  totalSteps: number;\n  isLoading: boolean;\n  error: Error | null;\n  setError: (error: Error | null) => void;\n}\n\nconst StepModalContext = createContext<StepModalContextType | null>(null);\n\nexport const useStepModal = () => {\n  const context = useContext(StepModalContext);\n  if (!context) {\n    throw new Error('useStepModal must be used within a StepModal');\n  }\n  return context;\n};\n\n/* -------------------------------------------------------------------------------------------------\n * StepModal\n * -----------------------------------------------------------------------------------------------*/\n\ninterface StepModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  title?: string;\n  children: ReactNode;\n  onComplete?: () => void;\n  onCancel?: () => void;\n}\n\ninterface StepProps {\n  title?: string;\n  children: ReactNode;\n  nextLabel?: string;\n  cancelLabel?: string;\n  backLabel?: string;\n  disableNext?: boolean;\n  onNext?: () => Promise<boolean> | boolean;\n}\n\nconst StepModal = ({\n  open,\n  onOpenChange,\n  title,\n  children,\n  onComplete,\n  onCancel,\n}: StepModalProps) => {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n\n  const childrenArray = Children.toArray(children)\n    .filter((child): child is React.ReactElement => isValidElement(child))\n    .map((child) => child.props);\n\n  const totalSteps = childrenArray.length;\n  const isFirstStep = currentStep === 0;\n  const isLastStep = currentStep === totalSteps - 1;\n\n  // Reset states when modal opens/closes\n  useEffect(() => {\n    if (!open) {\n      // Reset states when modal is closed\n      setCurrentStep(0);\n      setIsLoading(false);\n      setError(null);\n    }\n  }, [open]);\n\n  const resetStates = () => {\n    setCurrentStep(0);\n    setIsLoading(false);\n    setError(null);\n  };\n\n  const handleCancel = () => {\n    onCancel?.();\n    resetStates();\n    onOpenChange(false);\n  };\n\n  const handleBack = () => {\n    setCurrentStep((prev) => Math.max(0, prev - 1));\n    setError(null);\n  };\n\n  const nextStep = async () => {\n    const currentStepProps = childrenArray[currentStep];\n\n    if (currentStepProps.onNext) {\n      setIsLoading(true);\n      setError(null);\n\n      try {\n        if (isLastStep) {\n          onComplete?.();\n          resetStates();\n          onOpenChange(false);\n        } else {\n          await currentStepProps.onNext();\n          setCurrentStep((prev) => prev + 1);\n        }\n        return true;\n      } catch (err) {\n        setError(err instanceof Error ? err : new Error(String(err)));\n        return false;\n      } finally {\n        setIsLoading(false);\n      }\n    } else {\n      // Default behavior: just move to next step\n      if (isLastStep) {\n        onComplete?.();\n        resetStates();\n        onOpenChange(false);\n      } else {\n        setCurrentStep((prev) => prev + 1);\n      }\n      return true;\n    }\n  };\n\n  // Handle form submission (triggered by Enter key)\n  const handleFormSubmit = (e: FormEvent) => {\n    e.preventDefault();\n    if (!isLoading && !childrenArray[currentStep]?.disableNext) {\n      nextStep();\n    }\n  };\n\n  const contextValue = {\n    currentStep,\n    goToStep: setCurrentStep,\n    nextStep,\n    prevStep: handleBack,\n    isFirstStep,\n    isLastStep,\n    totalSteps,\n    isLoading,\n    error,\n    setError,\n  };\n\n  const currentChild = childrenArray[currentStep];\n\n  return (\n    <StepModalContext.Provider value={contextValue}>\n      {open && (\n        <Modal.Root open onOpenChange={handleCancel}>\n          <Modal.Content>\n            <Modal.Header>\n              <Typography variant=\"omega\" fontWeight=\"bold\">\n                {currentChild?.title || title}\n              </Typography>\n            </Modal.Header>\n\n            <form onSubmit={handleFormSubmit}>\n              <Modal.Body>\n                {Children.toArray(children)[currentStep]}\n\n                {error && (\n                  <Box\n                    marginTop={4}\n                    padding={3}\n                    background=\"danger100\"\n                    color=\"danger600\"\n                    borderRadius=\"4px\"\n                  >\n                    <Typography variant=\"pi\">{error.message}</Typography>\n                  </Box>\n                )}\n              </Modal.Body>\n\n              <Modal.Footer>\n                {isFirstStep ? (\n                  <Button variant=\"tertiary\" onClick={handleCancel} type=\"button\">\n                    {currentChild?.cancelLabel || 'Cancel'}\n                  </Button>\n                ) : (\n                  <Button variant=\"tertiary\" onClick={handleBack} type=\"button\">\n                    {currentChild?.backLabel || 'Back'}\n                  </Button>\n                )}\n\n                <Button\n                  variant=\"default\"\n                  type=\"submit\"\n                  disabled={isLoading || currentChild?.disableNext}\n                  loading={isLoading}\n                >\n                  {currentChild?.nextLabel || (isLastStep ? 'Complete' : 'Next')}\n                </Button>\n              </Modal.Footer>\n            </form>\n          </Modal.Content>\n        </Modal.Root>\n      )}\n    </StepModalContext.Provider>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * Step\n * -----------------------------------------------------------------------------------------------*/\n\nconst Step = ({ children }: StepProps) => {\n  return <>{children}</>;\n};\n\nStepModal.Step = Step;\n\nexport { StepModal, Step };\n"],"names":["StepModalContext","createContext","useStepModal","context","useContext","Error","StepModal","open","onOpenChange","title","children","onComplete","onCancel","currentStep","setCurrentStep","useState","isLoading","setIsLoading","error","setError","childrenArray","Children","toArray","filter","child","isValidElement","map","props","totalSteps","length","isFirstStep","isLastStep","useEffect","resetStates","handleCancel","handleBack","prev","Math","max","nextStep","currentStepProps","onNext","err","String","handleFormSubmit","e","preventDefault","disableNext","contextValue","goToStep","prevStep","currentChild","_jsx","Provider","value","Modal","Root","_jsxs","Content","Header","Typography","variant","fontWeight","form","onSubmit","Body","Box","marginTop","padding","background","color","borderRadius","message","Footer","Button","onClick","type","cancelLabel","backLabel","disabled","loading","nextLabel","Step","_Fragment"],"mappings":"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"}